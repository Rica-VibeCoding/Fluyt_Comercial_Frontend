# üìã TASKS DE INTEGRA√á√ÉO FRONTEND-BACKEND
**Sistema Fluyt Comercial - Tasks Execut√°veis**

## üéØ ESTRUTURA DE TASKS

### **Legenda de Prioridades**
- üî¥ **P0 - CR√çTICA:** Bloqueia desenvolvimento posterior
- üü† **P1 - ALTA:** Essencial para funcionalidade core
- üü° **P2 - M√âDIA:** Melhoria importante
- üü¢ **P3 - BAIXA:** Enhancement futuro

### **Status de Tasks**
- ‚úÖ **Conclu√≠da**
- üîÑ **Em Progresso**
- ‚è≥ **Aguardando**
- ‚ùå **Bloqueada**
- üìù **Planejada**

---

## ü•á FASE 1: FUNDA√á√ÉO DE CONECTIVIDADE

### **T1.1 - Configura√ß√£o de Ambiente** üî¥ P0
**Estimativa:** 4h | **Respons√°vel:** Dev Frontend + DevOps

#### **Subtasks:**
- [ ] **T1.1.1** - Unificar `.env` files entre frontend e backend
  - Criar `.env.example` padronizado
  - Documentar todas as vari√°veis obrigat√≥rias
  - Validar vari√°veis no startup de ambos sistemas

- [ ] **T1.1.2** - Configurar CORS no backend
  ```python
  # backend/core/config.py
  cors_origins: str = "http://localhost:3000,https://fluyt-frontend.vercel.app"
  ```

- [ ] **T1.1.3** - Criar health check endpoint
  ```typescript
  // Testar: GET /health
  // Resposta esperada: {"status": "healthy", "timestamp": "..."}
  ```

**Crit√©rio de Aceita√ß√£o:** Frontend consegue fazer GET /health e receber resposta 200

---

### **T1.2 - Cliente HTTP Base** üî¥ P0
**Estimativa:** 6h | **Respons√°vel:** Dev Frontend

#### **Subtasks:**
- [ ] **T1.2.1** - Criar `lib/api-client.ts`
  ```typescript
  // Estrutura base
  class ApiClient {
    private baseURL: string;
    private authToken: string | null;
    
    async get<T>(endpoint: string): Promise<T>
    async post<T>(endpoint: string, data: any): Promise<T>
    async put<T>(endpoint: string, data: any): Promise<T>
    async delete<T>(endpoint: string): Promise<T>
  }
  ```

- [ ] **T1.2.2** - Implementar interceptors
  ```typescript
  // Auto-inject JWT token
  // Auto-handle 401 (redirect to login)
  // Auto-handle 500 (show error toast)
  // Request/Response logging
  ```

- [ ] **T1.2.3** - Criar error handling unificado
  ```typescript
  // types/api.ts
  interface ApiError {
    message: string;
    code: string;
    details?: any;
  }
  
  // hooks/use-api-error.ts
  export function useApiError() {
    const showError = (error: ApiError) => {
      toast.error(error.message);
    };
    return { showError };
  }
  ```

**Crit√©rio de Aceita√ß√£o:** Cliente HTTP funcional com interceptors e error handling

---

### **T1.3 - Autentica√ß√£o Unificada** üî¥ P0
**Estimativa:** 8h | **Respons√°vel:** Dev Frontend + Dev Backend

#### **Subtasks:**
- [ ] **T1.3.1** - Integrar JWT do backend com Supabase
  ```typescript
  // hooks/use-auth.ts
  export function useAuth() {
    const [user, setUser] = useState(null);
    const [token, setToken] = useState(null);
    
    const login = async (email: string, password: string) => {
      // Chamar POST /api/v1/auth/login
      // Receber JWT token
      // Armazenar no localStorage
      // Configurar Supabase client com JWT
    };
    
    return { user, login, logout, isAuthenticated };
  }
  ```

- [ ] **T1.3.2** - Middleware de auth no backend
  ```python
  # Verificar se middleware AuthMiddleware est√° funcionando
  # Testar endpoints protegidos
  # Validar JWT decode e user context
  ```

- [ ] **T1.3.3** - Manter compatibilidade atual
  ```typescript
  // N√£o quebrar sistema atual de auth
  // Feature flag para alternar entre sistemas
  const useNewAuth = process.env.NEXT_PUBLIC_USE_NEW_AUTH === 'true';
  ```

**Crit√©rio de Aceita√ß√£o:** Login via backend retorna JWT v√°lido e permite acesso a endpoints protegidos

---

## ü•à FASE 2: M√ìDULOS CR√çTICOS

### **T2.1 - M√≥dulo Clientes (API Real)** üü† P1
**Estimativa:** 12h | **Respons√°vel:** Dev Frontend

#### **Subtasks:**
- [ ] **T2.1.1** - Criar service layer para clientes
  ```typescript
  // services/cliente.service.ts
  export class ClienteService {
    private api: ApiClient;
    
    async listarClientes(filtros?: ClienteFiltros): Promise<Cliente[]>
    async obterCliente(id: string): Promise<Cliente>
    async criarCliente(dados: ClienteCreate): Promise<Cliente>
    async atualizarCliente(id: string, dados: ClienteUpdate): Promise<Cliente>
    async excluirCliente(id: string): Promise<void>
  }
  ```

- [ ] **T2.1.2** - Atualizar hook `use-clientes.ts`
  ```typescript
  // Substituir dados mock por chamadas reais
  // Manter interface atual (zero breaking changes)
  // Adicionar loading states e error handling
  const { data: clientes, isLoading, error } = useQuery({
    queryKey: ['clientes', filtros],
    queryFn: () => clienteService.listarClientes(filtros)
  });
  ```

- [ ] **T2.1.3** - Migrar componentes de UI
  ```typescript
  // components/modulos/clientes/cliente-page.tsx
  // Manter UX id√™ntica
  // Adicionar feedback visual (loading, success, error)
  // Implementar optimistic updates
  ```

**Crit√©rio de Aceita√ß√£o:** CRUD de clientes funcionando 100% via API com UX mantida

---

### **T2.2 - M√≥dulo Ambientes** üü† P1
**Estimativa:** 10h | **Respons√°vel:** Dev Frontend + Dev Backend

#### **Subtasks:**
- [ ] **T2.2.1** - Integrar importa√ß√£o XML
  ```typescript
  // Upload de arquivo XML via multipart/form-data
  // Chamar POST /api/v1/ambientes/importar-xml
  // Processar resposta com ambientes extra√≠dos
  const uploadXML = async (file: File) => {
    const formData = new FormData();
    formData.append('arquivo', file);
    return api.post('/ambientes/importar-xml', formData);
  };
  ```

- [ ] **T2.2.2** - Conectar c√°lculos de valor
  ```typescript
  // Usar valores calculados pelo backend
  // Manter interface de ambientes atual
  // Adicionar valida√ß√µes server-side
  ```

- [ ] **T2.2.3** - Relacionamento cliente-ambiente
  ```typescript
  // Persistir relacionamentos no database
  // Sincronizar com sessaoSimples
  // Implementar cache inteligente
  ```

**Crit√©rio de Aceita√ß√£o:** Importa√ß√£o XML e gest√£o de ambientes funcionando via API

---

### **T2.3 - Sistema de Sess√£o H√≠brido** üü† P1
**Estimativa:** 14h | **Respons√°vel:** Dev Frontend

#### **Subtasks:**
- [ ] **T2.3.1** - Adapter pattern para sess√£o
  ```typescript
  // lib/sessao-adapter.ts
  interface SessaoAdapter {
    carregar(): Promise<SessaoOrcamento>;
    salvar(sessao: SessaoOrcamento): Promise<void>;
    limpar(): Promise<void>;
  }
  
  class SessaoLocalAdapter implements SessaoAdapter {
    // Implementa√ß√£o atual com localStorage
  }
  
  class SessaoAPIAdapter implements SessaoAdapter {
    // Nova implementa√ß√£o com backend
  }
  ```

- [ ] **T2.3.2** - Sincroniza√ß√£o inteligente
  ```typescript
  // Estrat√©gia de conflict resolution
  // Cache local + sync com servidor
  // Offline support b√°sico
  const useSessaoHibrida = () => {
    const [sessaoLocal, setSessaoLocal] = useState();
    const [sessaoRemota, setSessaoRemota] = useState();
    
    // Sync logic aqui
    const sync = async () => {
      // Merge local + remote
      // Resolve conflicts
      // Update both stores
    };
  };
  ```

- [ ] **T2.3.3** - Migration path
  ```typescript
  // Migrar dados existentes do localStorage para API
  // Manter compatibilidade durante transi√ß√£o
  // Feature flag para rollback
  ```

**Crit√©rio de Aceita√ß√£o:** Sistema h√≠brido funcional com sync autom√°tico e conflict resolution

---

## ü•â FASE 3: OR√áAMENTOS INTELIGENTES

### **T3.1 - Engine de C√°lculos Integrada** üü° P2
**Estimativa:** 16h | **Respons√°vel:** Dev Frontend + Dev Backend

#### **Subtasks:**
- [ ] **T3.1.1** - Conectar calculadora frontend
  ```typescript
  // Substituir c√°lculos locais por API calls
  // POST /api/v1/orcamentos/calcular
  const calcularOrcamento = async (dados: DadosOrcamento) => {
    return api.post('/orcamentos/calcular', {
      cliente_id: dados.clienteId,
      ambiente_ids: dados.ambienteIds,
      desconto_percentual: dados.desconto,
      custos_adicionais: dados.custosAdicionais
    });
  };
  ```

- [ ] **T3.1.2** - Valida√ß√µes real-time
  ```typescript
  // Validar desconto em tempo real
  // Chamar GET /api/v1/orcamentos/validar-desconto
  // Mostrar se precisa aprova√ß√£o
  const validarDesconto = useDebouncedCallback(async (desconto: number) => {
    const resultado = await api.get(`/orcamentos/validar-desconto?percentual=${desconto}`);
    setNecessitaAprovacao(resultado.necessita_aprovacao);
  }, 500);
  ```

- [ ] **T3.1.3** - Comiss√µes e margens
  ```typescript
  // Integrar engine Pandas do backend
  // Mostrar c√°lculos detalhados (apenas para admin)
  // Cache de configura√ß√µes por loja
  ```

**Crit√©rio de Aceita√ß√£o:** C√°lculos de or√ßamento via backend com valida√ß√µes real-time

---

### **T3.2 - Simulador Financeiro** üü° P2
**Estimativa:** 12h | **Respons√°vel:** Dev Frontend

#### **Subtasks:**
- [ ] **T3.2.1** - Formas de pagamento persistidas
  ```typescript
  // Salvar formas de pagamento via API
  // POST /api/v1/orcamentos/{id}/formas-pagamento
  // Manter UX atual do simulador
  ```

- [ ] **T3.2.2** - C√°lculos de valor presente via API
  ```typescript
  // Usar algoritmos do backend para VP
  // Integrar com engine de c√°lculos
  // Manter interface edit√°vel atual
  ```

- [ ] **T3.2.3** - Sistema de aprova√ß√£o
  ```typescript
  // Implementar workflow de aprova√ß√£o
  // Notifica√ß√µes via Supabase real-time
  // Estados: NEGOCIACAO, AGUARDANDO_APROVACAO, APROVADO
  ```

**Crit√©rio de Aceita√ß√£o:** Simulador funcionando com persist√™ncia e aprova√ß√£o autom√°tica

---

### **T3.3 - Persist√™ncia de Or√ßamentos** üü° P2
**Estimativa:** 10h | **Respons√°vel:** Dev Frontend

#### **Subtasks:**
- [ ] **T3.3.1** - CRUD de or√ßamentos
  ```typescript
  // Implementar opera√ß√µes completas
  // POST /api/v1/orcamentos (criar)
  // GET /api/v1/orcamentos/{id} (carregar)
  // PUT /api/v1/orcamentos/{id} (atualizar)
  // DELETE /api/v1/orcamentos/{id} (excluir)
  ```

- [ ] **T3.3.2** - Versionamento
  ```typescript
  // Hist√≥rico de altera√ß√µes
  // Snapshots de configura√ß√£o
  // Auditoria de mudan√ßas
  ```

- [ ] **T3.3.3** - Lista de or√ßamentos
  ```typescript
  // P√°gina de listagem com filtros
  // Pagina√ß√£o server-side
  // Busca por cliente, valor, status
  ```

**Crit√©rio de Aceita√ß√£o:** Or√ßamentos persistidos com hist√≥rico e busca funcional

---

## üèÖ FASE 4: RECURSOS AVAN√áADOS

### **T4.1 - Real-time e Colabora√ß√£o** üü¢ P3
**Estimativa:** 8h | **Respons√°vel:** Dev Frontend

#### **Subtasks:**
- [ ] **T4.1.1** - Supabase subscriptions
  ```typescript
  // Real-time updates para or√ßamentos
  // Notifica√ß√µes de aprova√ß√£o
  // Sync multi-usu√°rio
  const useRealtimeOrcamento = (orcamentoId: string) => {
    useEffect(() => {
      const subscription = supabase
        .channel(`orcamento_${orcamentoId}`)
        .on('postgres_changes', {
          event: '*',
          schema: 'public',
          table: 'c_orcamentos',
          filter: `id=eq.${orcamentoId}`
        }, handleChange)
        .subscribe();
      
      return () => subscription.unsubscribe();
    }, [orcamentoId]);
  };
  ```

- [ ] **T4.1.2** - Notifica√ß√µes push
  ```typescript
  // Toast notifications para mudan√ßas
  // Badge counts para pend√™ncias
  // Sistema de alertas
  ```

**Crit√©rio de Aceita√ß√£o:** Updates em tempo real funcionando entre usu√°rios

---

### **T4.2 - Relat√≥rios e Analytics** üü¢ P3
**Estimativa:** 12h | **Respons√°vel:** Dev Frontend + Dev Backend

#### **Subtasks:**
- [ ] **T4.2.1** - M√≥dulo contratos integrado
- [ ] **T4.2.2** - Relat√≥rios de margem via API
- [ ] **T4.2.3** - Dashboard com m√©tricas reais

**Crit√©rio de Aceita√ß√£o:** Relat√≥rios funcionais com dados do backend

---

### **T4.3 - Sistema Completo** üü¢ P3
**Estimativa:** 10h | **Respons√°vel:** Dev Full-Stack

#### **Subtasks:**
- [ ] **T4.3.1** - M√≥dulo Sistema integrado
- [ ] **T4.3.2** - Configura√ß√µes enterprise
- [ ] **T4.3.3** - Auditoria completa

**Crit√©rio de Aceita√ß√£o:** Sistema 100% integrado e funcional

---

## üìä TRACKING E M√âTRICAS

### **Kanban de Tasks**
```
üìù BACKLOG     | üîÑ EM PROGRESSO | ‚úÖ CONCLU√çDO    | üöÄ DEPLOY
T1.1 - Env     | T1.2 - HTTP     | T1.1.1 - .env  | T1.0 - Base
T1.3 - Auth    | T2.1 - Clientes |                 |
T2.2 - Ambien  |                  |                 |
...            |                  |                 |
```

### **M√©tricas de Progresso**
- **Fase 1:** 3 tasks = 18h estimadas
- **Fase 2:** 3 tasks = 36h estimadas  
- **Fase 3:** 3 tasks = 38h estimadas
- **Fase 4:** 3 tasks = 30h estimadas
- **TOTAL:** 12 tasks = 122h = ~15 dias √∫teis

### **Dependencies Graph**
```
T1.1 (Env) ‚Üí T1.2 (HTTP) ‚Üí T1.3 (Auth)
     ‚Üì
T2.1 (Clientes) ‚Üí T2.2 (Ambientes) ‚Üí T2.3 (Sess√£o)
     ‚Üì
T3.1 (Engine) ‚Üí T3.2 (Simulador) ‚Üí T3.3 (Persist√™ncia)
     ‚Üì
T4.1 (Real-time) ‚Üí T4.2 (Reports) ‚Üí T4.3 (Complete)
```

---

## üö® TASK CR√çTICAS (IMEDIATAS)

### **Sprint 1 (Pr√≥ximos 5 dias)**
1. **T1.1** - Configura√ß√£o de Ambiente (Dia 1)
2. **T1.2** - Cliente HTTP Base (Dia 2-3)
3. **T1.3** - Autentica√ß√£o Unificada (Dia 4-5)

### **Sprint 2 (Dias 6-10)**
1. **T2.1** - M√≥dulo Clientes Real (Dia 6-8)
2. **T2.2** - M√≥dulo Ambientes (Dia 9-10)

### **Sprint 3 (Dias 11-15)**
1. **T2.3** - Sistema Sess√£o H√≠brido (Dia 11-13)
2. **T3.1** - Engine C√°lculos (Dia 14-15)

**üéØ Meta:** Ter sistema base funcionando em 15 dias

---

## üîß FERRAMENTAS DE DESENVOLVIMENTO

### **Task Management**
- **Kanban:** GitHub Projects ou Linear
- **Time Tracking:** Toggl ou RescueTime
- **Code Review:** GitHub Pull Requests
- **QA:** Checklist por task + testes automatizados

### **Testing Strategy**
```typescript
// Para cada task, implementar:
// 1. Unit tests (Jest)
// 2. Integration tests (API calls)
// 3. E2E tests (Playwright) para fluxos cr√≠ticos
// 4. Manual QA checklist
```

### **Documentation**
- Cada task deve atualizar documenta√ß√£o relevante
- README.md com setup instructions
- API documentation auto-gerada
- Deployment guide atualizado

---

**üìã PR√ìXIMA A√á√ÉO:** Iniciar T1.1 - Configura√ß√£o de Ambiente
**‚è∞ ETA:** Sistema b√°sico funcionando em 2 semanas
**üéØ META:** Integra√ß√£o completa em 1 m√™s