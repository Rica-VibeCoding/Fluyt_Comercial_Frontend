â— Excelente ideia! Vou criar um documento detalhado que vocÃª pode salvar
  para garantir continuidade caso perca o histÃ³rico. Aqui estÃ¡ a
  documentaÃ§Ã£o completa:

  ðŸ“‹ DOCUMENTO DE PLANEJAMENTO - CORREÃ‡ÃƒO ERRO SSR/clientModules

  ðŸš¨ CONTEXTO CRÃTICO

  - Erro Atual: TypeError: Cannot read properties of undefined (reading 
  'clientModules')
  - Sistema: Next.js 15.3.3 + React 19 + Zustand + Sistema de PersistÃªncia     
   Inteligente
  - Problema: Conflitos SSR/CSR causando falha na inicializaÃ§Ã£o
  - Status: Plan mode ativo, aguardando execuÃ§Ã£o

  ðŸŽ¯ OBJETIVO PRINCIPAL

  Corrigir erro de SSR que impede inicializaÃ§Ã£o da aplicaÃ§Ã£o, mantendo
  todas as funcionalidades existentes de persistÃªncia inteligente por
  cliente.

  ---
  ðŸ“ PLANO DETALHADO DE EXECUÃ‡ÃƒO

  FASE 1: CORREÃ‡ÃƒO LAYOUT RAIZ (CRÃTICO - PRIORIDADE MÃXIMA)

  Arquivo: src/app/layout.tsx

  Problema: 'use client' no layout raiz forÃ§a toda aplicaÃ§Ã£o ao
  client-side
  AÃ§Ã£o Detalhada:

  1. Remover 'use client' da primeira linha
  2. Criar novo arquivo src/components/providers/client-providers.tsx
  3. Mover QueryClient, TooltipProvider, Toaster para o novo arquivo
  4. Importar ClientProviders no layout como componente filho

  CÃ³digo para ClientProviders:
  'use client';
  // Todos os providers que precisam rodar no cliente
  // QueryClient, TooltipProvider, Toaster, etc.

  ---
  FASE 2: PROTEÃ‡ÃƒO LOCALSTORAGE (CRÃTICO - PRIORIDADE MÃXIMA)

  Arquivo: src/lib/store/cliente-store.ts

  Problema: Acesso direto ao localStorage durante SSR
  AÃ§Ãµes Detalhadas:

  1. Adicionar guards SSR em TODOS os mÃ©todos:
  // Antes de qualquer localStorage.setItem/getItem
  if (typeof window === 'undefined') return;

  2. Verificar funÃ§Ãµes:
    - salvarCliente()
    - carregarCliente()
    - removerCliente()
    - limparTodosClientes()
  3. Adicionar tratamento de erro para falhas de localStorage

  ---
  FASE 3: STORE ZUSTAND SEGURO (ALTA PRIORIDADE)

  Arquivo: src/store/sessao-store.ts

  Problema: Chamadas para persistenciaInteligente durante SSR
  AÃ§Ãµes Detalhadas:

  1. Envolver TODAS as chamadas persistenciaInteligente.* com:
  if (typeof window !== 'undefined') {
    persistenciaInteligente.salvarSessaoCliente(...)
  }

  2. FunÃ§Ãµes a proteger:
    - definirCliente()
    - salvarSessaoAtual()
    - carregarSessaoCliente()
    - limparSessaoCompleta()

  ---
  FASE 4: SISTEMA PERSISTÃŠNCIA (ALTA PRIORIDADE)

  Arquivo: src/lib/persistencia-inteligente.ts

  Problema: Timers e cleanup automÃ¡tico rodando durante SSR
  AÃ§Ãµes Detalhadas:

  1. Modificar construtor da classe:
  constructor() {
    // SÃ³ inicializar no cliente
    if (typeof window !== 'undefined') {
      this.iniciarCleanupAutomatico();
      this.limparSessoesExpiradas();
    }
  }

  2. Adicionar guards em TODOS os mÃ©todos que usam localStorage
  3. Criar inicializaÃ§Ã£o lazy para a instÃ¢ncia singleton

  ---
  FASE 5: HOOKS FORTALECIDOS (MÃ‰DIA PRIORIDADE)

  Arquivo: src/hooks/globais/use-local-storage.ts

  Problema: Precisa de proteÃ§Ã£o SSR mais robusta
  AÃ§Ãµes Detalhadas:

  1. Melhorar verificaÃ§Ã£o inicial:
  const [storedValue, setStoredValue] = useState(() => {
    if (typeof window === 'undefined') {
      return initialValue; // Sempre retornar valor padrÃ£o no servidor
    }
    // Resto da lÃ³gica...
  });

  2. Adicionar tratamento de erro mais robusto
  3. Verificar compatibilidade com hidrataÃ§Ã£o

  ---
  FASE 6: AUDITORIA COMPONENTES (BAIXA PRIORIDADE)

  Arquivos: VÃ¡rios componentes com 'use client'

  Problema: 25+ componentes podem ter diretivas desnecessÃ¡rias
  AÃ§Ãµes Detalhadas:

  1. Listar todos os arquivos com 'use client'
  2. Avaliar necessidade de cada um
  3. Remover diretivas desnecessÃ¡rias
  4. Otimizar fronteiras SSR/CSR

  ---
  ðŸ”§ INSTRUÃ‡Ã•ES DE EXECUÃ‡ÃƒO

  Para Retomar Trabalho Sem Contexto:

  1. Verifique o erro atual:
  npm run dev

  2. Confirme se ainda Ã© clientModules error
  3. Execute fases na ordem:
    - Fase 1 â†’ Teste â†’ Fase 2 â†’ Teste â†’ etc.
  4. Teste apÃ³s cada fase:
  npm run dev

  5. Se erro persistir, verifique se todas as proteÃ§Ãµes SSR foram
  aplicadas

  Comandos de Teste:

  # Testar build
  npm run build

  # Testar desenvolvimento
  npm run dev

  # Verificar tipos
  npm run type-check

  ---
  ðŸ“‚ ARQUIVOS PRINCIPAIS A MODIFICAR

  1. src/app/layout.tsx - Remover 'use client'
  2. src/components/providers/client-providers.tsx - CRIAR NOVO
  3. src/lib/store/cliente-store.ts - Adicionar guards SSR
  4. src/store/sessao-store.ts - Proteger persistÃªncia
  5. src/lib/persistencia-inteligente.ts - Lazy initialization
  6. src/hooks/globais/use-local-storage.ts - Fortalecer SSR

  ---
  ðŸŽ¯ RESULTADOS ESPERADOS

  Antes: Erro clientModules impede inicializaÃ§Ã£o
  Depois:
  - âœ… Next.js inicia normalmente
  - âœ… SSR funcionando
  - âœ… PersistÃªncia por cliente mantida
  - âœ… Performance melhorada
  - âœ… Todos os comentÃ¡rios em PT-BR

  ---
  ðŸš¨ NOTAS IMPORTANTES

  1. SEMPRE testar apÃ³s cada fase
  2. NUNCA pular a ordem das fases
  3. MANTER todas as funcionalidades existentes
  4. ADICIONAR comentÃ¡rios em portuguÃªs brasileiro
  5. BACKUP do cÃ³digo antes de comeÃ§ar

  ---
  Este documento contÃ©m TUDO necessÃ¡rio para retomar o trabalho caso perca     
   o contexto da conversa.

  Salve este documento e use como referÃªncia para continuar o projeto!